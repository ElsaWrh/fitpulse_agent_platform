# 脉动健康 · 多维生活管理系统（FitPulse）  
用户需求说明 & 项目需求分析

> 说明：本项目原名为「脉动健身 · 多维健康监测系统」,现微调为  
> **「脉动健康 · 多维生活管理系统（FitPulse）」**，在保持健身核心的同时，扩展支持心脑血管、糖尿病等慢病相关的生活方式管理与健康科普场景。

---

## 1. 项目概述

### 1.1 项目定位

**FitPulse** 是一个面向个人用户的**生活方式与健康管理 AI 平台**。  

在本系统中：

- "教练"与"顾问"以 **AI 智能体（Agent）** 的形式存在；
- 用户可以像在 Coze 中创建 Bot 一样，自主创建和配置适合自己的：
  - 健身教练（减脂 / 增肌 / 综合训练）
  - 营养顾问
  - 睡眠与恢复顾问
  - 心血管健康顾问
  - 糖尿病/代谢综合征生活管理顾问 等。

系统围绕三个核心能力展开：

1. **可创建的智能体（AI 教练 / 顾问）平台**  
2. **健身 + 慢病生活管理知识库（RAG 检索增强生成）**  
3. **健康管理工作流：初次评估、周期性复盘、风险识别与提醒**

在此基础上，系统增加 **“拍照记录饮食 + AI 自动评估”** 能力：  
用户可以拍照上传一日三餐，由 AI 自动识别食物、估算卡路里，并结合用户的减脂/增肌目标及高血压、糖尿病等慢病风险，给出红/黄/绿灯式饮食评估和解释。

其他功能（用户资料、健康档案、多维数据展示）集中在「个人中心」页面中实现，作为智能体决策的基础数据支撑，但不是 UI 上的主角。

系统采用前后端分离架构，后端基于 **Spring Boot + MySQL + JWT + RBAC**，集成大语言模型与检索服务，实现一个可配置、可扩展的健康与生活方式管理平台。

---

### 1.2 学习目标

通过本项目，学习者将掌握：

- Spring Boot 后端开发与分层架构设计  
- MySQL 数据库表结构设计（用户、角色、智能体、知识库、会话、工作流等）  
- JWT 认证机制与基于 RBAC 的权限控制  
- RESTful API 设计与统一响应格式  
- 多轮会话管理与上下文存储  
- 大语言模型（LLM）调用与 **RAG 检索增强生成** 集成  
- 健康管理工作流设计与实现（定时任务 + 状态流转）  
- 基于 **拍照识别的一日三餐记录与 AI 营养评估** 能力设计与落地  
- 核心接口的自动化测试与联调

---

### 1.3 最终系统架构

系统包括以下部分：

- **后端：**
  - Spring Boot 3.x  
  - MySQL + MyBatis / MyBatis-Plus  
  - Spring Security + JWT  
  - LLM 调用模块（封装大模型 HTTP 客户端）  
  - 检索服务模块（向量检索 / 混合检索）  
  - 工作流与定时任务模块（初评、周报、风险提醒）  
  - 图像/多模态识别模块（用于识别饮食图片、估算卡路里及结构化食物信息）

- **数据库：**
  - 用户与权限：`user`、`role`、`permission`、`user_role`、`role_permission`  
  - 智能体：`agent`、`agent_config`、`agent_usage`  
  - 健康档案与数据：
    - `health_profile`（基础档案：身高、体重、目标、慢病风险等）
    - `workout_log`（训练记录）
    - `weight_log`（体重 / BMI 变化）
    - `sleep_log`（睡眠记录）
    - `diet_log`（饮食记录，支持文字录入与**拍照 AI 识别 + 红黄绿灯评估**）
  - 知识库：`kb_article`、`kb_category`  
  - 会话管理：`conversation`、`message`  
  - 工作流：`workflow_instance`、`workflow_log`、`weekly_report` 等

- **API：**
  - 统一 RESTful 接口，统一返回结构 `{ code, message, data }`  
  - 健康档案、体重/训练/睡眠/饮食记录相关接口  
  - **一日三餐拍照上传 + AI 识别与评估接口**  
  - 一组供前端与智能体调用的业务接口（健康档案、训练数据、知识检索等）

- **测试：**
  - 针对登录、智能体创建、对话接口、知识库查询、工作流触发、饮食拍照识别等核心路径的自动化测试

---

### 1.4 预期成果

最终系统应实现：

- **用户与健康档案管理**
  - 支持注册、登录、个人信息管理
  - 支持维护基础健康档案（身高、体重、目标、运动经验、慢病风险提示等）

- **AI 教练 / 顾问智能体平台**
  - 用户可使用系统内置的官方智能体：
    - 减脂教练、增肌教练、营养顾问、睡眠顾问
    - 心血管健康顾问、糖尿病生活管理顾问 等
  - 用户可创建和配置自己的智能体（教练 / 顾问）

- **多轮对话与会话管理**
  - 支持与指定智能体多轮对话
  - 支持上下文记忆与历史会话记录查看

- **RAG 健身 + 慢病生活管理知识库**
  - 管理健身训练、营养、睡眠、心血管健康、糖尿病生活管理等知识条目
  - 智能体基于知识库检索相关内容进行回答，并可提示参考来源

- **健康管理工作流**
  - 首次评估与训练/生活方式计划自动生成
  - 周期性健康报告自动生成（训练 + 生活方式层面）
  - 基于规则的风险识别与提醒（过度训练、体重异常变化、可能严重症状）

- **AI 饮食识别与评估**
  - 支持用户拍照记录一日三餐
  - 系统自动识别图片中的食物、估算本餐及单品卡路里
  - 结合用户目标（如减脂/增肌）和慢病风险（如高血压/糖尿病），对该餐及主要食物给出红/黄/绿灯级别评估，并用自然语言解释原因
  - 将识别与评估结果写入饮食记录，支撑周报与风险提醒

- **安全与权限控制**
  - 完整 RBAC 角色体系：管理员 / 普通用户 / 访客
  - 严格的健康安全边界：
    - 不提供医疗诊断和处方
    - 对高风险内容进行就医引导

---

## 2. 用户角色设计

> 说明：系统只区分"人"的角色（管理员 / 普通用户 / 访客），**"教练 / 顾问"由智能体（Agent）实现**。

### 2.1 管理员（Admin）

- **权限：**
  - 用户与角色管理  
  - 智能体审核与下架  
  - 知识库内容管理与合规审核  
  - 工作流配置与基础统计查看

- **职责：**
  - 系统初始化与配置
  - 管理公开智能体与公共知识库
  - 处理违规内容和系统异常情况

- **典型场景：**
  - 审核用户提交的公开智能体（包括健身教练与慢病顾问）
  - 维护健身与慢病知识库条目，确保内容专业健康

---

### 2.2 普通用户（User）

- **权限：**
  - 注册、登录、修改个人信息  
  - 维护自身健康档案  
  - 使用系统内置智能体（AI 教练 / 顾问）  
  - 创建并管理个人专属智能体  
  - 查看个人训练计划、健康报告与风险提醒  
  - 使用拍照记录一日三餐，并查看 AI 给出的饮食红黄绿灯评估

- **职责：**
  - 利用平台管理 personal 健身与生活方式
  - 根据智能体建议进行训练、饮食和生活方式调整

- **典型场景：**
  - 使用"标准减脂教练"生成 30 天减脂计划  
  - 使用"心血管健康顾问"了解安全心率区间与生活方式建议  
  - 创建一个"夜跑友好型减脂教练"作为自己的长期教练  
  - 每天拍照记录一日三餐，让系统告诉自己当餐是否适合减脂、高血压是否需要控制盐分等

---

### 2.3 访客（Visitor）

- **权限：**
  - 无需登录访问公开介绍与示例内容  
  - 查看示例智能体与样例对话记录

- **职责：**
  - 了解系统功能和价值，决定是否注册使用

- **典型场景：**
  - 浏览项目首页和功能介绍页面  
  - 查看健身与健康顾问的示例对话截图

> RBAC 层面可设计角色：`ROLE_ADMIN`、`ROLE_USER`，访客为未认证状态。

---

## 3. 核心功能需求

### 3.1 用户认证与个人中心模块

#### 3.1.1 用户注册

- 支持邮箱 + 密码注册  
- 邮箱格式校验与唯一性检查  
- 密码强度校验（长度与复杂度）  
- 注册成功自动赋予"普通用户"角色  

#### 3.1.2 用户登录 / 登出

- 支持邮箱 + 密码登录  
- 使用 JWT 生成访问 Token，包含用户 ID 与角色信息  
- 登录失败给出明确错误信息  
- 支持安全登出（前端清除 Token，后端可选 Token 黑名单）

#### 3.1.3 个人中心与健康档案

- 用户可在个人中心查看与编辑：
  - 昵称、头像、性别、年龄  
  - 身高、当前体重、目标体重（自动计算 BMI）  
  - 运动经验水平（初学 / 中级 / 高级）  
  - 每周可训练天数与大致可用时间段  
  - 健康状况备注：是否已有确诊疾病（仅作提示，不做诊断）、家族史、运动禁忌等

- 健康档案作为智能体（健身教练 / 慢病顾问）生成建议的重要输入，也作为 **饮食拍照评估时的约束条件**：
  - 当用户目标为减脂时，对高热量、高糖、高脂食物更严格；
  - 当用户有高血压风险时，对高盐加工肉制品、重口味菜品给出更谨慎的黄/红灯提示；
  - 当用户有糖尿病风险时，对含糖饮料、精制碳水食品给出警示。

> UI 可简化为一页表单，重点是接口与数据结构的完整性。

---

### 3.2 智能体平台模块（AI 教练 / 顾问）

#### 3.2.1 官方智能体市场

系统内置若干官方智能体，分为两大类：

- **健身训练类：**
  - 标准减脂教练  
  - 标准增肌教练  
  - 综合训练教练  
  - 睡眠与恢复顾问  
  - 营养顾问

- **慢病生活管理与健康科普类：**
  - 心血管健康顾问  
  - 糖尿病生活管理顾问  
  - 代谢综合征生活方式顾问（可选）

**展示内容：**

- 名称、头像、简介  
- 功能标签（减脂 / 增肌 / 营养 / 睡眠 / 心血管 / 糖代谢 等）  
- 面向人群说明（如：有心血管风险关注但**必须遵医嘱**）

**用户操作：**

- 浏览官方智能体列表  
- 将某个智能体"添加到我的教练/顾问"列表  
- 之后可在聊天界面选择使用

---

#### 3.2.2 用户自定义智能体创建

普通用户可以创建个人专属智能体（教练 / 顾问）：

- **基本信息：**
  - 名称、头像、简介  
  - 功能类别：减脂教练 / 增肌教练 / 综合训练 / 营养顾问 / 睡眠顾问 / 慢病科普顾问 等

- **行为设定（Prompt）：**
  - 智能体身份（如"擅长有氧与力量结合的减脂教练"）  
  - 推荐原则（渐进负荷、避免极端饮食等）  
  - 语言风格（鼓励型、理性科普型等）  
  - **安全边界：明确声明不提供医疗诊断、不开具用药建议，只做一般性生活方式建议**

- **LLM 模型选择:**
  - 用户可选择该智能体使用的 AI 模型（如 GPT-4、Claude、通义千问等）
  - 系统提供默认推荐模型，用户也可根据需要自定义：
    - 高性能模型（GPT-4 Turbo、Claude 3.5 Sonnet）：适合复杂健康分析、个性化计划生成
    - 快速响应模型（GPT-3.5 Turbo、通义千问）：适合日常对话、简单答疑
  - 显示不同模型的特点（速度、效果、价格）帮助用户选择
  - 后续对话时也可临时切换模型

- **工具权限选择:**
  - 是否可以读取用户健康档案  
  - 是否可以查看最近训练记录、体重曲线等  
  - 是否可以写入训练计划 / 日志  
  - 是否可以访问知识库及其分类：
    - 健身训练类知识库（减脂、增肌、有氧、力量等）
    - 慢病生活管理知识库（心血管健康科普、糖尿病生活方式科普等）

- **知识库范围绑定:**
  - 通过多选标签绑定该智能体可访问的知识库分类
  - 例如：
    - "心血管健康顾问"绑定「心血管生活方式科普」「适宜运动强度」「戒烟限酒」  
    - "糖尿病生活管理顾问"绑定「饮食控制」「膳食结构」「低 GI 食物」等分类

- **可见性设置：**
  - `private`：仅创建者本人可见、可用  
  - `public_pending`：申请公开，待管理员审核  
  - `public`：管理员审核通过后在智能体市场中展示

---

#### 3.2.3 智能体测试与发布

- 在创建 / 编辑页提供测试对话区域：
  - 用户可以直接与配置中的智能体对话，查看回答效果
- 当配置与测试都满意后：
  - 可保存为私有智能体  
  - 或提交为公开智能体，进入管理员审核流程

---

#### 3.2.4 智能体使用与切换

- 用户在"我的教练/顾问"列表中查看可用智能体  
- 聊天界面可以选择当前使用的智能体，并随时切换  
- 每个会话绑定 `agentId`，后端根据该 ID 获取配置（prompt、kb_scope、工具权限等）

---

### 3.3 聊天与会话管理模块

- 新建会话时指定智能体  
- 多轮对话：
  - 后端存储每一轮用户消息和智能体回复  
  - 调用模型时带入最近 N 轮上下文
- 会话管理：
  - 会话列表按时间排序  
  - 支持查看详情  
  - 支持软删除（用户侧隐藏，数据可用于统计）
- 可对重要对话"标星"（可选）

---

### 3.4 知识库（RAG）模块

#### 3.4.1 知识条目管理

由管理员维护知识库内容：

- 字段示例：
  - 标题  
  - 正文内容（富文本 / Markdown）  
  - 分类（如下所示）  
  - 标签（关键词）  
  - 来源（指南、公开健康教育材料等）  
  - 更新时间

#### 3.4.2 知识分类示例

- **健身训练类：**
  - 减脂训练基础  
  - 增肌与力量训练基础  
  - 有氧与心肺训练  
  - 训练周期与恢复原则  
  - 常见运动风险与警示

- **营养与睡眠类：**
  - 能量平衡与宏量营养素  
  - 健康饮食结构与用餐节奏  
  - 睡眠与恢复相关建议

- **慢病生活管理与科普类（重点新增）：**
  - 心血管健康与生活方式管理科普
    - 血压控制原则
    - 安全心率与运动强度常识
    - 戒烟限酒、减压等
  - 糖尿病与代谢综合征生活方式管理科普
    - 饮食控制与碳水化合物摄入
    - 低 GI 食物与膳食纤维
    - 进餐规律与配合运动建议
  - 高危信号与就医时机提醒（不做诊断，只做"需就医"提示）

> 慢病知识库内容定位为 **健康教育与生活方式科普**，不包含具体诊断流程、处方药名及剂量等医疗决策信息。

#### 3.4.3 检索能力

- 关键词检索（模糊匹配）  
- 向量检索（使用嵌入模型 + 向量库进行 TopK 检索）  
- 可选混合检索：关键词与向量分数加权融合

#### 3.4.4 智能体调用知识库

- 后端根据智能体的 `kb_scope` 限定其可访问的知识分类  
- 对每次用户提问：
  1. 基于问题与用户档案，检索若干相关知识片段  
  2. 将片段作为"证据"注入 Prompt  
  3. 调用 LLM 生成基于证据的回答  
- 响应中可选展示"参考条目标题 / 来源"，实现可解释性

---

### 3.5 健康管理工作流模块

#### 3.5.1 初次评估与计划生成工作流

- **触发条件：**
  - 用户首次完善健康档案  
  - 或关键目标字段（目标体重、目标训练频率等）发生变化

- **主要步骤：**
  1. 读取最新健康档案与目标  
  2. 调用用户设置的主智能体（如减脂教练）  
  3. 基于档案、目标和知识库生成 7/14/30 天计划（训练为主，饮食与作息为辅）  
  4. 将结果保存到 `plan` 表，并在个人中心"我的计划"展示

---

#### 3.5.2 周期性健康报告工作流

- **触发方式：**
  - 定时任务（如每周日晚）

- **主要步骤：**
  1. 汇总本周训练数据、体重变化、睡眠数据及部分饮食记录（包括拍照识别结果）  
  2. 调用指定智能体生成"周度健康报告"，内容包括：
     - 完成情况  
     - 亮点与问题（如"晚餐多次出现红灯高盐高脂餐食"）  
     - 下周建议（训练 + 生活方式层面）
  3. 保存到 `weekly_report` 表  
  4. 在用户登录后提示有新报告可查看

---

#### 3.5.3 风险识别与提醒工作流

- **触发规则示例：**
  - 7 天内体重变化超过安全阈值  
  - 连续训练天数远超健康档案设定上限  
  - 对话中出现"胸痛、呼吸困难、视物模糊、极度乏力"等潜在高危症状描述  
  - 短期内连续多次出现 **高盐、高脂、高糖红灯餐食**（依据 AI 饮食识别结果）

- **主要步骤：**
  1. 定时或事件触发检测规则  
  2. 一旦触发规则，调用对应的风险顾问智能体生成谨慎提示：
     - 明确说明"系统无法判断严重程度"  
     - 强调"请尽快线下就医或咨询医生"
  3. 将提醒记录到 `workflow_instance` / `risk_alert` 表  
  4. 在前端醒目展示提醒信息

---

#### 3.5.4 拍照识别一日三餐与饮食红黄绿灯评估

- **功能描述：**
  - 用户在"饮食记录"页面选择日期与餐次（早/中/晚/加餐），拍照上传该餐图片（一张或多张）。
  - 系统调用图像识别/多模态模型，对图片中的食物进行识别与粗略重量估算，生成结构化食物列表。
  - 系统计算本餐估算总卡路里，并结合用户健康档案中的：
    - 当前体重与目标（减脂/增肌/维持）
    - 运动量与每日建议能量摄入
    - 慢病风险标记（如高血压/糖尿病风险）
  - 给出本餐整体以及关键食物的 **红/黄/绿灯评估**：
    - 绿灯（green）：整体较符合当前目标与慢病限制；
    - 黄灯（yellow）：存在可以优化的地方（略油、略咸、主食偏多等）；
    - 红灯（red）：明显不符合，例如：
      - 减脂期连续出现高油炸、高糖饮料等；
      - 高血压风险用户大量食用腌制品、重口味高盐菜；
      - 糖尿病风险用户进食大量精制糖、含糖饮料等。
  - 系统生成简短但具体的自然语言解释，例如：
    - "这顿饭整体蛋白质和蔬菜不错，但炸鸡和含糖饮料会显著增加热量，不利于当前减脂目标。"
    - "作为有高血压风险的用户，这顿饭中的腌制肉和重口味菜品盐分偏高，建议控制频率和分量。"

- **数据处理：**
  - 将识别出的食物列表、估算卡路里、红黄绿灯评估及触发的规则记录到饮食数据表中（`diet_log`），与用户 ID、日期和餐次绑定。
  - 后续周报与风险识别工作流可直接使用这些结构化结果，无需再次解析原始图片。

- **前端呈现：**
  - 在"饮食记录"中，以卡片形式展示：
    - 饭菜缩略图
    - 本餐估算卡路里
    - 总体红黄绿灯图标
    - 一两句话的重点点评
  - 用户可以回看历史某一天的三餐评估，了解自己一段时间内饮食习惯的变化。

---

### 3.6 管理后台与安全合规模块

#### 3.6.1 管理后台功能

- 用户与角色管理：
  - 查看用户列表  
  - 分配 / 调整角色（Admin / User）  
  - 冻结或禁用用户

- 智能体审核：
  - 查看待审核公开智能体的配置（包含行为设定 Prompt 与可访问知识库范围）  
  - 审核通过或驳回，并写明理由  
  - 对违反规则的公开智能体进行下架

- 知识库管理：
  - 新增 / 编辑 / 删除知识条目  
  - 按分类、标签筛选  
  - 标记并处理不合规内容（如过度医疗化、误导性内容）

- 基本统计（可简化）：
  - 注册用户数、活跃用户数  
  - 智能体调用次数  
  - 工作流触发次数（计划生成、周报、风险提醒）  
  - **饮食拍照识别调用次数与红黄绿灯分布（可选统计）**

#### 3.6.2 安全与合规约束

- **健康定位：**
  - 系统主要提供训练、饮食、睡眠与慢病相关的生活方式建议与科普信息  
  - 明确不提供医疗诊断、不推荐具体药物名称及剂量、不替代线下就医
  - **饮食红黄绿灯评估仅为一般性健康建议，不构成营养处方或医疗建议**

- **Prompt & 业务双重约束：**
  - 对心血管、糖尿病等慢病相关智能体，Prompt 中必须写入：
    - "不能提供诊断与用药建议"  
    - "如用户提及严重或急性症状,需引导其立即就医"
  - 对饮食拍照识别结果，在文案层面强调"仅供参考，如有疾病请遵医嘱"。
  - 在服务端业务逻辑中，对高危关键词触发强制就医提示

- **安全开发要求：**
  - 密码加密存储（如 BCrypt）  
  - 使用 JWT 做认证授权  
  - 防御 SQL 注入、XSS、CSRF 等安全问题  
  - 对关键操作（智能体发布、知识库修改、模型配置等）记录操作日志

---

## 4. 用户故事

> 仅列出代表性的故事，具体项目可按优先级实现子集。

### 4.1 注册与登录

**故事1：邮箱注册账户**  
作为游客，我希望通过邮箱和密码注册账户，以便开始使用 FitPulse 的健身与健康顾问智能体。

**验收标准：**

- 可以输入邮箱和密码进行注册  
- 邮箱格式验证通过且未被使用  
- 密码满足强度要求  
- 注册成功后自动成为普通用户

---

**故事2：邮箱登录系统**  
作为已注册用户，我希望通过邮箱和密码登录，以访问我的健康档案与智能体。

**验收标准：**

- 输入正确邮箱与密码可成功登录  
- 失败时有明确错误提示  
- 登录成功生成 JWT Token 并跳转到主页面

---

### 4.2 个人中心与健康档案

**故事3：维护健康档案**  
作为普通用户，我希望维护我的健康档案，让智能体能够根据我的体重、目标、慢病风险等信息给出个性化建议。

**验收标准：**

- 可以编辑身高、当前体重、目标体重、运动经验、训练频率等  
- 可以填写慢病相关信息（如"已由医生确诊为高血压"）和运动禁忌  
- 提交后自动计算 BMI 并显示  
- 智能体后续回答会体现对档案信息的关注（如对有高血压风险用户控制运动强度）

---

**故事4：查看计划与报告**  
作为普通用户，我希望在个人中心查看我的训练/生活方式计划与历史健康报告。

**验收标准：**

- 可以查看当前生效的训练/生活方式计划  
- 可以查看历史周报列表和详情  
- 新报告生成时有提示

---

### 4.3 智能体创建与管理

**故事5：使用官方减脂教练**  
作为普通用户，我希望不做复杂配置，直接使用系统内置的标准减脂教练，快速获得训练建议。

**验收标准：**

- 可以在智能体市场看到标准减脂教练  
- 可以一键添加到"我的教练"  
- 在聊天页面可选择该教练并进行多轮对话

---

**故事6：创建个人专属智能体教练**  
作为普通用户，我希望创建一个符合我作息和偏好的健身教练智能体，获得更贴合我的训练建议。

**验收标准：**

- 可以设置名称、头像、简介及角色设定 Prompt  
- 可以配置可访问知识库分类和工具权限  
- 可以选择"仅自己可见"  
- 创建成功后出现在"我的教练/顾问"列表中

---

**故事7：选择智能体使用的 AI 模型**  
作为普通用户，我希望在创建或使用智能体时选择合适的 AI 模型，以平衡对话质量、响应速度和使用成本。

**验收标准：**

- 创建智能体时可以从可用模型列表中选择（如 GPT-4、Claude、通义千问等）  
- 能看到不同模型的简要说明（速度、效果、适用场景）  
- 可以设置默认模型，也可以在对话时临时切换模型  
- 系统记录每次对话使用的具体模型，便于后续分析效果

---

**故事8：创建慢病生活管理顾问**  
作为普通用户，我希望创建一个"心血管健康顾问"或"糖尿病生活管理顾问"，从生活方式角度获得科普与建议。

**验收标准：**

- 可以选择"慢病科普顾问"类型  
- 可以绑定慢病相关知识库分类  
- 智能体回答围绕生活方式与健康教育，不涉及诊断和用药  
- 智能体始终提醒"遵医嘱、必要时就医"

---

### 4.4 与智能体对话 & RAG

**故事9：基于档案生成训练建议**  
作为用户，我希望减脂教练在给建议时能考虑我的 BMI、训练经验和时间安排。

**验收标准：**

- 修改档案后，生成的计划明显变化（如训练频率与强度调整）  
- 智能体会引用档案信息（如"考虑到你目前是初学者…"）

---

**故事10：使用心血管健康顾问获得生活方式建议**  
作为对心血管健康有担忧的用户，我希望通过心血管健康顾问获得基于科普资料的生活方式建议。

**验收标准：**

- 能选择该智能体并开始对话  
- 回答聚焦生活方式建议，如低盐饮食、适当中低强度有氧、戒烟限酒等  
- 如果我描述可能的严重症状(如胸痛、呼吸困难),智能体不会继续提供训练方案,而是建议立即就医

---

**故事11: 糖尿病生活管理建议**  
作为担心血糖问题的用户,我希望糖尿病生活管理顾问能从饮食和日常活动方面给我一些一般性建议。

**验收标准:**

- 回答围绕饮食结构、进餐节奏、低 GI 食物、适度运动等  
- 明确强调"本系统不进行诊断和用药调整,需严格遵医嘱"  
- 无药物名称与剂量推荐

---

**故事12：拍照记录一日三餐并获得饮食红黄绿灯提示**  
作为正在减脂或需要控制血压/血糖的用户，我希望通过拍照上传一日三餐，让系统自动识别食物与卡路里，并告诉我这顿饭对当前健康目标是绿灯、黄灯还是红灯。

**验收标准：**

- 在"饮食记录"页面，可以选择日期与餐次（早餐/午餐/晚餐/加餐），上传一张或多张餐食照片；  
- 系统自动识别图片中的主要食物，给出大致种类和估算卡路里；  
- 系统结合我的健康档案信息（如当前减脂目标、高血压/糖尿病风险），对该餐整体和关键食物给出红/黄/绿灯评估；  
- 系统用简短但清晰的语言说明评估原因，例如："本餐整体蔬菜与蛋白质尚可，但炸鸡和含糖饮料会显著增加热量，不利于当前减脂目标" 或 "考虑到你的高血压风险，这顿饭中腌制肉类和重口味菜肴盐分偏高"；  
- 该评估结果可以在之后的周度报告中被引用（如"本周有 3 顿晚餐为红灯高盐高脂餐"）。

---

### 4.5 工作流相关故事

**故事13: 首次填写档案后自动获得计划**  
作为用户,我希望在首次完善健康档案后,系统自动为我生成训练与生活方式基础计划。

**验收标准:**

- 完善档案后无需额外操作即可生成计划  
- 计划包括训练频率、训练类型和生活方式建议  
- 可以在"我的计划"中查看

---

**故事14: 每周健康报告**  
作为用户,我希望每周收到一份健康报告,了解训练完成情况和生活方式方面的改进建议。

**验收标准:**

- 每周自动生成一份报告  
- 报告涵盖本周训练执行情况、体重变化和简单生活方式建议  
- 当本周存在较多红灯饮食时，报告中会有针对性的饮食建议  
- 新报告在登录后有提示

---

**故事15: 风险识别与提醒**  
作为用户,我希望在训练过量或者可能存在严重健康风险时,系统能主动提醒我谨慎对待健康问题。

**验收标准:**

- 规则触发时自动生成提醒(例如体重骤升/骤降、症状异常、连续多日红灯饮食等)  
- 提醒内容谨慎安全,引导用户就医或休息  
- 不给出缺乏依据的诊断或过激建议

---

### 4.6 管理与安全

**故事16：管理员审核公开智能体**  
作为管理员，我希望审核用户提交的公开智能体，防止不合规内容（尤其是慢病相关错误信息）扩散。

**验收标准：**

- 能查看智能体配置（包括 Prompt 与知识库范围）  
- 可以审核通过或驳回，并记录原因  
- 不允许存在声称"可以诊断疾病或替代医生"的描述

---

**故事17：管理员维护知识库**  
作为管理员，我希望维护健身与慢病生活管理知识库，保证内容的科学性与安全性。

**验收标准：**

- 可以对条目进行增删改查  
- 可以标记高风险内容并做下架处理  
- 用户查询和智能体调用不会访问已下架条目

---

## 5. 非功能性需求

### 5.1 性能

- 普通接口（登录、档案查询、列表等）响应时间 < 500ms  
- LLM 调用接口前端需有 Loading 与超时提示  
- 饮食拍照识别接口应在合理时间内返回（例如 3–8 秒内），前端需明确显示处理状态  
- 数据库适当加索引，保证在常规数据量下查询性能

---

### 5.2 安全

- 密码加密存储（如 BCrypt）  
- 使用 JWT 进行身份认证与授权  
- 防范 SQL 注入、XSS、CSRF 等常见攻击  
- 对关键操作记录审计日志（智能体发布、知识库修改、模型配置、饮食识别服务调用异常等）

---

### 5.3 可维护性与可扩展性

- 清晰的分层结构：用户模块、智能体模块、知识库模块、会话模块、工作流模块、图像识别模块等  
- 接口风格统一，方便前后端协作  
- 智能体配置、图像识别与知识库设计支持未来扩展更多健康场景（如孕期管理、老年人平衡与防跌倒、儿童成长营养等）

---

## 6. 验收标准总结

系统应满足以下综合标准：

- 核心闭环可用：
  - 用户注册 → 完善档案 → 选择/创建智能体 → 多轮对话 → 自动生成计划与报告 → 风险提醒  
  - 用户可以通过拍照记录一日三餐，并获得可理解的饮食红黄绿灯评估

- 权限与安全边界合理：
  - 管理员与普通用户权限清晰  
  - 所有慢病相关建议严格限定在**生活方式与科普层面**，不越界到诊疗  
  - 饮食评估明确为"一般性健康建议"，不代替营养师或医生决策

- 工作流可正常触发与查看结果：
  - 初评计划生成、周期报告与风险提醒链路完整  
  - 周报与风险提醒能够利用饮食识别结果进行合理提示

- 核心接口具备基础自动化测试，系统整体运行稳定。

---

## 7. 功能优先级划分

### 高优先级（MVP 核心）

- 用户注册 / 登录 / JWT 认证  
- 健康档案维护（基础字段）  
- 官方智能体市场（至少减脂教练 + 1 个慢病顾问）  
- 用户创建智能体（基础配置 + 保存）  
- 与智能体的多轮对话（含基础 RAG 检索）  
- 初次评估 & 计划生成工作流  
- **拍照上传单餐图片，AI 识别食物与卡路里，并给出红黄绿灯评估；结果写入饮食记录**

### 中优先级

- 周度健康报告工作流（包含对饮食红黄绿灯的周度统计提示）  
- 风险识别与提醒工作流（可结合连续红灯饮食情况）  
- 管理员后台（用户管理、智能体审核、知识库维护）  
- 智能体在线测试区域  
- 饮食记录列表查询与历史可视化（卡路里趋势、红黄绿灯分布）

### 低优先级

- 会话标星、导出等高级功能  
- 更复杂的统计与运营报表  
- 多语言支持与高级可视化  
- 对单个食物更精细的营养素估算与配方拆解

---
