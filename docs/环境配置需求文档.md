# FitPulse ç¯å¢ƒé…ç½®éœ€æ±‚æ–‡æ¡£

**è„‰åŠ¨å¥åº· Â· å¤šç»´ç”Ÿæ´»ç®¡ç†ç³»ç»Ÿï¼ˆFitPulseï¼‰**  
ç¯å¢ƒéƒ¨ç½²ä¸é…ç½®è§„èŒƒ Â· Docker å®¹å™¨åŒ–æŒ‡å—

---

## ğŸ“‹ ç›®å½•

- [1. æ€»è§ˆ](#1-æ€»è§ˆ)
- [2. æŠ€æœ¯æ ˆç‰ˆæœ¬è¦æ±‚](#2-æŠ€æœ¯æ ˆç‰ˆæœ¬è¦æ±‚)
- [3. ç¯å¢ƒåˆ†ç±»](#3-ç¯å¢ƒåˆ†ç±»)
- [4. åç«¯ç¯å¢ƒé…ç½®](#4-åç«¯ç¯å¢ƒé…ç½®)
- [5. å‰ç«¯ç¯å¢ƒé…ç½®](#5-å‰ç«¯ç¯å¢ƒé…ç½®)
- [6. æ•°æ®åº“é…ç½®](#6-æ•°æ®åº“é…ç½®)
- [7. ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®](#7-ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®)
- [8. Docker å®¹å™¨åŒ–é…ç½®](#8-docker-å®¹å™¨åŒ–é…ç½®)
- [9. éƒ¨ç½²æ¶æ„](#9-éƒ¨ç½²æ¶æ„)
- [10. å®‰å…¨é…ç½®](#10-å®‰å…¨é…ç½®)
- [11. ç›‘æ§ä¸æ—¥å¿—](#11-ç›‘æ§ä¸æ—¥å¿—)
- [12. ç‰ˆæœ¬å‘å¸ƒæµç¨‹](#12-ç‰ˆæœ¬å‘å¸ƒæµç¨‹)

---

## 1. æ€»è§ˆ

### 1.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx (åå‘ä»£ç†)                     â”‚
â”‚                  HTTPS / è´Ÿè½½å‡è¡¡ / é™æ€èµ„æº              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend      â”‚                    â”‚  Backend        â”‚
â”‚  Vue 3 + Vite  â”‚                    â”‚  Spring Boot    â”‚
â”‚  Node.js       â”‚                    â”‚  JDK 17+        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                          â”‚                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  MySQL 8.0+    â”‚        â”‚  Redis 7.x     â”‚    â”‚  MinIO / OSS   â”‚
            â”‚  (ä¸»æ•°æ®åº“)     â”‚        â”‚  (ç¼“å­˜/Session)â”‚    â”‚  (å¯¹è±¡å­˜å‚¨)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚  LLM Provider   â”‚
                                      â”‚  OpenAI / Azure â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç¯å¢ƒæ¦‚è§ˆ

| ç¯å¢ƒ | ç”¨é€” | åŸŸåç¤ºä¾‹ | ç‰¹ç‚¹ |
|------|------|---------|------|
| **å¼€å‘ç¯å¢ƒ** (Dev) | æœ¬åœ°å¼€å‘æµ‹è¯• | localhost | çƒ­é‡è½½ã€è°ƒè¯•æ¨¡å¼ |
| **æµ‹è¯•ç¯å¢ƒ** (Test) | é›†æˆæµ‹è¯•ã€UAT | test.fitpulse.com | æ¨¡æ‹Ÿç”Ÿäº§æ•°æ® |
| **é¢„å‘å¸ƒç¯å¢ƒ** (Staging) | ä¸Šçº¿å‰éªŒè¯ | staging.fitpulse.com | ç”Ÿäº§é…ç½®é•œåƒ |
| **ç”Ÿäº§ç¯å¢ƒ** (Prod) | æ­£å¼æœåŠ¡ | api.fitpulse.com | é«˜å¯ç”¨ã€ç›‘æ§ |

---

## 2. æŠ€æœ¯æ ˆç‰ˆæœ¬è¦æ±‚

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ | è¯´æ˜ |
|------|---------|---------|------|
| **Java** | JDK 17+ | JDK 17 LTS | OpenJDK æ¨è |
| **Spring Boot** | 3.2.x | 3.2.x | æœ€æ–°ç¨³å®šç‰ˆ |
| **Maven** | 3.9+ | 3.9+ | æ„å»ºå·¥å…· |
| **MySQL** | 8.0.33+ | 8.0.35+ | ä¸»æ•°æ®åº“ |
| **Redis** | 7.2+ | 7.2+ | ç¼“å­˜/Session |
| **Nginx** | 1.24+ | 1.24+ | åå‘ä»£ç† |

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ | è¯´æ˜ |
|------|---------|---------|------|
| **Node.js** | 20.x LTS | 20.x LTS | è¿è¡Œæ—¶ |
| **npm** | 10.x | 10.x | åŒ…ç®¡ç†å™¨ |
| **Vue** | 3.4+ | 3.4+ | å‰ç«¯æ¡†æ¶ |
| **Vite** | 5.x | 5.x | æ„å»ºå·¥å…· |

### 2.3 ç¬¬ä¸‰æ–¹æœåŠ¡

| æœåŠ¡ | ç”¨é€” | å¿…éœ€æ€§ |
|------|------|--------|
| **OpenAI API** | LLM å¯¹è¯ã€é£Ÿç‰©è¯†åˆ« | âœ… å¿…éœ€ |
| **Azure OpenAI** | å¤‡ç”¨ LLM æä¾›å•† | å¯é€‰ |
| **MinIO / é˜¿é‡Œäº‘ OSS** | å›¾ç‰‡å­˜å‚¨ | âœ… å¿…éœ€ |
| **é˜¿é‡Œäº‘çŸ­ä¿¡** | éªŒè¯ç å‘é€ | å¯é€‰ |

---

## 3. ç¯å¢ƒåˆ†ç±»

### 3.1 å¼€å‘ç¯å¢ƒ (Development)

**ç”¨é€”**: æœ¬åœ°å¼€å‘ã€å•å…ƒæµ‹è¯•

**ç‰¹ç‚¹**:
- çƒ­é‡è½½å¼€å¯
- è¯¦ç»†æ—¥å¿—è¾“å‡º
- ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
- Mock éƒ¨åˆ†ç¬¬ä¸‰æ–¹æœåŠ¡

**å¯åŠ¨æ–¹å¼**:
```bash
# åç«¯
cd backend
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# å‰ç«¯
cd frontend
npm run dev
```

---

### 3.2 æµ‹è¯•ç¯å¢ƒ (Test)

**ç”¨é€”**: é›†æˆæµ‹è¯•ã€UAT ç”¨æˆ·éªŒæ”¶æµ‹è¯•

**ç‰¹ç‚¹**:
- ç‹¬ç«‹æµ‹è¯•æ•°æ®åº“
- æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒé…ç½®
- ä½¿ç”¨æµ‹è¯• API Key
- å¼€å¯æ—¥å¿—æ”¶é›†

**éƒ¨ç½²æ–¹å¼**: Docker Compose

---

### 3.3 é¢„å‘å¸ƒç¯å¢ƒ (Staging)

**ç”¨é€”**: ä¸Šçº¿å‰æœ€åéªŒè¯

**ç‰¹ç‚¹**:
- ä¸ç”Ÿäº§ç¯å¢ƒé…ç½®å®Œå…¨ä¸€è‡´
- ä½¿ç”¨ç”Ÿäº§çº§æ•°æ®åº“ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
- çœŸå® LLM API è°ƒç”¨
- æ€§èƒ½æµ‹è¯•

**éƒ¨ç½²æ–¹å¼**: Kubernetes / Docker Swarm

---

### 3.4 ç”Ÿäº§ç¯å¢ƒ (Production)

**ç”¨é€”**: æ­£å¼å¯¹å¤–æœåŠ¡

**ç‰¹ç‚¹**:
- é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²
- æ•°æ®åº“ä¸»ä»å¤åˆ¶
- Redis å“¨å…µ/é›†ç¾¤
- å®Œæ•´ç›‘æ§å‘Šè­¦
- è‡ªåŠ¨å¤‡ä»½

**éƒ¨ç½²æ–¹å¼**: Kubernetes

---

## 4. åç«¯ç¯å¢ƒé…ç½®

### 4.1 application.yml é…ç½®ç»“æ„

```
backend/src/main/resources/
â”œâ”€â”€ application.yml                    # å…¬å…±é…ç½®
â”œâ”€â”€ application-dev.yml                # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml               # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ application-staging.yml            # é¢„å‘å¸ƒç¯å¢ƒ
â””â”€â”€ application-prod.yml               # ç”Ÿäº§ç¯å¢ƒ
```

---

### 4.2 å…¬å…±é…ç½® (application.yml)

```yaml
spring:
  application:
    name: fitpulse-backend
  
  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 50MB
  
  # JPA é…ç½®
  jpa:
    hibernate:
      ddl-auto: none  # ç”Ÿäº§ç¯å¢ƒç¦æ­¢è‡ªåŠ¨å»ºè¡¨
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

# æœåŠ¡å™¨é…ç½®
server:
  port: 8080
  compression:
    enabled: true
  servlet:
    context-path: /api

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    com.example.backend: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# JWT é…ç½®
jwt:
  secret: ${JWT_SECRET}  # ç¯å¢ƒå˜é‡
  expiration: 7200  # 2å°æ—¶ (ç§’)
  refresh-expiration: 604800  # 7å¤© (ç§’)

# ä¸šåŠ¡é…ç½®
fitpulse:
  # æ–‡ä»¶å­˜å‚¨
  storage:
    type: ${STORAGE_TYPE:minio}  # minio / oss / local
    base-path: /data/uploads
  
  # AI é…ç½®
  ai:
    default-provider: openai
    timeout: 30000  # 30ç§’
  
  # é™æµé…ç½®
  rate-limit:
    enabled: true
    requests-per-minute: 60
```

---

### 4.3 å¼€å‘ç¯å¢ƒ (application-dev.yml)

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/fitpulse_dev?useUnicode=true&characterEncoding=utf8mb4&serverTimezone=Asia/Shanghai
    username: root
    password: dev123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
  
  # Redis
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 5000ms
  
  # JPA
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update  # å¼€å‘ç¯å¢ƒå…è®¸è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„

# æ—¥å¿—
logging:
  level:
    root: INFO
    com.example.backend: DEBUG
    org.springframework.web: DEBUG
  file:
    name: logs/fitpulse-dev.log

# MinIO (æœ¬åœ°)
minio:
  endpoint: http://localhost:9000
  access-key: minioadmin
  secret-key: minioadmin
  bucket-name: fitpulse-dev

# OpenAI (æµ‹è¯• Key)
openai:
  api-key: ${OPENAI_API_KEY}
  base-url: https://api.openai.com/v1
  model: gpt-4o-mini  # å¼€å‘ä½¿ç”¨ä¾¿å®œæ¨¡å‹
  max-tokens: 2048
  temperature: 0.7
```

---

### 4.4 æµ‹è¯•ç¯å¢ƒ (application-test.yml)

```yaml
spring:
  datasource:
    url: jdbc:mysql://mysql-test:3306/fitpulse_test?useUnicode=true&characterEncoding=utf8mb4&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 10
  
  data:
    redis:
      host: redis-test
      port: 6379
      password: ${REDIS_PASSWORD}
      database: 0

logging:
  level:
    root: INFO
    com.example.backend: INFO
  file:
    name: /var/log/fitpulse/backend-test.log

minio:
  endpoint: http://minio-test:9000
  access-key: ${MINIO_ACCESS_KEY}
  secret-key: ${MINIO_SECRET_KEY}
  bucket-name: fitpulse-test

openai:
  api-key: ${OPENAI_API_KEY}
  base-url: https://api.openai.com/v1
  model: gpt-4o-mini
```

---

### 4.5 ç”Ÿäº§ç¯å¢ƒ (application-prod.yml)

```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:mysql-prod}:3306/fitpulse_prod?useUnicode=true&characterEncoding=utf8mb4&serverTimezone=Asia/Shanghai&useSSL=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 50
      minimum-idle: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  data:
    redis:
      host: ${REDIS_HOST:redis-prod}
      port: 6379
      password: ${REDIS_PASSWORD}
      database: 0
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 50
          max-idle: 20
          min-idle: 10

# æ—¥å¿—
logging:
  level:
    root: WARN
    com.example.backend: INFO
  file:
    name: /var/log/fitpulse/backend.log
    max-size: 100MB
    max-history: 30

# MinIO / OSS
minio:
  endpoint: ${MINIO_ENDPOINT}
  access-key: ${MINIO_ACCESS_KEY}
  secret-key: ${MINIO_SECRET_KEY}
  bucket-name: fitpulse-prod

# OpenAI (ç”Ÿäº§ Key)
openai:
  api-key: ${OPENAI_API_KEY}
  base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1}
  model: gpt-4o  # ç”Ÿäº§ä½¿ç”¨å®Œæ•´æ¨¡å‹
  max-tokens: 4096
  temperature: 0.7

# ç›‘æ§
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
```

---

## 5. å‰ç«¯ç¯å¢ƒé…ç½®

### 5.1 ç¯å¢ƒå˜é‡æ–‡ä»¶ç»“æ„

```
frontend/
â”œâ”€â”€ .env                    # å…¬å…±é…ç½®
â”œâ”€â”€ .env.development        # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ .env.test              # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ .env.staging           # é¢„å‘å¸ƒç¯å¢ƒ
â””â”€â”€ .env.production        # ç”Ÿäº§ç¯å¢ƒ
```

---

### 5.2 å¼€å‘ç¯å¢ƒ (.env.development)

```env
# åº”ç”¨é…ç½®
VITE_APP_TITLE=FitPulse - å¼€å‘ç¯å¢ƒ
VITE_APP_ENV=development

# API é…ç½®
VITE_API_BASE_URL=http://localhost:8080/api
VITE_API_TIMEOUT=30000

# æ–‡ä»¶ä¸Šä¼ 
VITE_UPLOAD_MAX_SIZE=10485760  # 10MB

# è°ƒè¯•
VITE_DEBUG=true
VITE_MOCK_ENABLED=false
```

---

### 5.3 æµ‹è¯•ç¯å¢ƒ (.env.test)

```env
VITE_APP_TITLE=FitPulse - æµ‹è¯•ç¯å¢ƒ
VITE_APP_ENV=test

VITE_API_BASE_URL=https://test-api.fitpulse.com/api
VITE_API_TIMEOUT=30000

VITE_UPLOAD_MAX_SIZE=10485760

VITE_DEBUG=true
VITE_MOCK_ENABLED=false
```

---

### 5.4 ç”Ÿäº§ç¯å¢ƒ (.env.production)

```env
VITE_APP_TITLE=FitPulse - è„‰åŠ¨å¥åº·
VITE_APP_ENV=production

VITE_API_BASE_URL=https://api.fitpulse.com/api
VITE_API_TIMEOUT=30000

VITE_UPLOAD_MAX_SIZE=10485760

VITE_DEBUG=false
VITE_MOCK_ENABLED=false

# CDN é…ç½®
VITE_CDN_URL=https://cdn.fitpulse.com
```

---

## 6. æ•°æ®åº“é…ç½®

### 6.1 MySQL é…ç½®è¦æ±‚

#### å¼€å‘ç¯å¢ƒ

```ini
[mysqld]
# åŸºç¡€é…ç½®
port=3306
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
default-storage-engine=INNODB

# æ€§èƒ½é…ç½®
max_connections=100
innodb_buffer_pool_size=256M
innodb_log_file_size=64M

# æ—¥å¿—
general_log=1
slow_query_log=1
long_query_time=2
```

#### ç”Ÿäº§ç¯å¢ƒ

```ini
[mysqld]
# åŸºç¡€é…ç½®
port=3306
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
default-storage-engine=INNODB

# æ€§èƒ½é…ç½®
max_connections=500
innodb_buffer_pool_size=4G
innodb_log_file_size=512M
innodb_flush_log_at_trx_commit=1
sync_binlog=1

# ä¸»ä»å¤åˆ¶
server-id=1
log-bin=mysql-bin
binlog-format=ROW
expire_logs_days=7

# æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log=1
long_query_time=1
log_queries_not_using_indexes=1

# å®‰å…¨é…ç½®
bind-address=0.0.0.0
skip-name-resolve
sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
```

---

### 6.2 æ•°æ®åº“åˆå§‹åŒ–

#### åˆ›å»ºæ•°æ®åº“

```sql
-- å¼€å‘ç¯å¢ƒ
CREATE DATABASE IF NOT EXISTS fitpulse_dev 
  DEFAULT CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- æµ‹è¯•ç¯å¢ƒ
CREATE DATABASE IF NOT EXISTS fitpulse_test 
  DEFAULT CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- ç”Ÿäº§ç¯å¢ƒ
CREATE DATABASE IF NOT EXISTS fitpulse_prod 
  DEFAULT CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;
```

#### åˆ›å»ºç”¨æˆ·

```sql
-- å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°ï¼‰
CREATE USER 'fitpulse_dev'@'localhost' IDENTIFIED BY 'Dev@2025!';
GRANT ALL PRIVILEGES ON fitpulse_dev.* TO 'fitpulse_dev'@'localhost';

-- ç”Ÿäº§ç¯å¢ƒï¼ˆé™åˆ¶IPï¼‰
CREATE USER 'fitpulse_prod'@'10.0.%.%' IDENTIFIED BY 'Prod@SecurePassword!';
GRANT SELECT, INSERT, UPDATE, DELETE ON fitpulse_prod.* TO 'fitpulse_prod'@'10.0.%.%';

FLUSH PRIVILEGES;
```

---

### 6.3 Redis é…ç½®

#### å¼€å‘ç¯å¢ƒ

```conf
# redis-dev.conf
port 6379
bind 127.0.0.1
protected-mode yes
daemonize yes

# æŒä¹…åŒ–
save 900 1
save 300 10
save 60 10000

# å†…å­˜
maxmemory 256mb
maxmemory-policy allkeys-lru
```

#### ç”Ÿäº§ç¯å¢ƒ

```conf
# redis-prod.conf
port 6379
bind 0.0.0.0
protected-mode yes
requirepass ${REDIS_PASSWORD}

# æŒä¹…åŒ–
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec

# å†…å­˜
maxmemory 2gb
maxmemory-policy allkeys-lru

# æ…¢æŸ¥è¯¢
slowlog-log-slower-than 10000
slowlog-max-len 128

# é›†ç¾¤é…ç½®ï¼ˆå¯é€‰ï¼‰
# cluster-enabled yes
# cluster-config-file nodes.conf
# cluster-node-timeout 5000
```

---

## 7. ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®

### 7.1 å¯¹è±¡å­˜å‚¨é…ç½®

#### MinIO (æœ¬åœ°/æµ‹è¯•)

```yaml
# docker-compose.yml ç‰‡æ®µ
minio:
  image: minio/minio:latest
  ports:
    - "9000:9000"
    - "9001:9001"
  environment:
    MINIO_ROOT_USER: minioadmin
    MINIO_ROOT_PASSWORD: minioadmin
  command: server /data --console-address ":9001"
  volumes:
    - minio_data:/data
```

#### é˜¿é‡Œäº‘ OSS (ç”Ÿäº§)

```yaml
# application-prod.yml
aliyun:
  oss:
    endpoint: ${OSS_ENDPOINT}  # oss-cn-beijing.aliyuncs.com
    access-key-id: ${OSS_ACCESS_KEY_ID}
    access-key-secret: ${OSS_ACCESS_KEY_SECRET}
    bucket-name: fitpulse-prod
    base-path: uploads/
    cdn-url: https://cdn.fitpulse.com
```

---

### 7.2 LLM æä¾›å•†é…ç½®

#### OpenAI

```yaml
openai:
  api-key: ${OPENAI_API_KEY}
  base-url: https://api.openai.com/v1
  organization: ${OPENAI_ORG_ID}  # å¯é€‰
  
  # æ¨¡å‹é…ç½®
  models:
    chat: gpt-4o
    vision: gpt-4o  # é£Ÿç‰©è¯†åˆ«
    embedding: text-embedding-3-small
  
  # è¶…æ—¶ä¸é‡è¯•
  timeout: 30000
  max-retries: 3
  retry-delay: 1000
```

#### Azure OpenAI (å¤‡ç”¨)

```yaml
azure-openai:
  endpoint: ${AZURE_OPENAI_ENDPOINT}
  api-key: ${AZURE_OPENAI_API_KEY}
  deployment-name: gpt-4o
  api-version: 2024-02-15-preview
  
  timeout: 30000
  max-retries: 3
```

---

## 8. Docker å®¹å™¨åŒ–é…ç½®

### 8.1 Dockerfile - åç«¯

```dockerfile
# backend/Dockerfile
# å¤šé˜¶æ®µæ„å»º

# é˜¶æ®µ1: æ„å»º
FROM maven:3.9-eclipse-temurin-17 AS builder

WORKDIR /app

# å¤åˆ¶ pom.xml å¹¶ä¸‹è½½ä¾èµ–ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY pom.xml .
RUN mvn dependency:go-offline -B

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY src ./src
RUN mvn clean package -DskipTests -B

# é˜¶æ®µ2: è¿è¡Œ
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# æ·»åŠ é root ç”¨æˆ·
RUN addgroup -S fitpulse && adduser -S fitpulse -G fitpulse

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/target/*.jar app.jar

# ä¿®æ”¹æ‰€æœ‰è€…
RUN chown -R fitpulse:fitpulse /app

# åˆ‡æ¢ç”¨æˆ·
USER fitpulse

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:8080/api/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‚æ•°
ENV JAVA_OPTS="-Xms512m -Xmx1024m -XX:+UseG1GC"
ENV SPRING_PROFILES_ACTIVE=prod

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar --spring.profiles.active=$SPRING_PROFILES_ACTIVE"]
```

---

### 8.2 Dockerfile - å‰ç«¯

```dockerfile
# frontend/Dockerfile
# å¤šé˜¶æ®µæ„å»º

# é˜¶æ®µ1: æ„å»º
FROM node:20-alpine AS builder

WORKDIR /app

# å¤åˆ¶ package.jsonï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY . .
RUN npm run build

# é˜¶æ®µ2: è¿è¡Œ
FROM nginx:1.24-alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:80/health || exit 1

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

---

### 8.3 Nginx é…ç½® (frontend/nginx.conf)

```nginx
server {
    listen 80;
    server_name _;
    
    root /usr/share/nginx/html;
    index index.html;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript 
               application/json application/javascript application/xml+rss;
    
    # SPA è·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API ä»£ç†ï¼ˆå¯é€‰ï¼‰
    location /api/ {
        proxy_pass http://backend:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
    
    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location /health {
        access_log off;
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
}
```

---

### 8.4 Docker Compose - å¼€å‘ç¯å¢ƒ

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  # MySQL
  mysql:
    image: mysql:8.0
    container_name: fitpulse-mysql-dev
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: root123456
      MYSQL_DATABASE: fitpulse_dev
      MYSQL_USER: fitpulse
      MYSQL_PASSWORD: fitpulse123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./init-db:/docker-entrypoint-initdb.d
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    networks:
      - fitpulse-network

  # Redis
  redis:
    image: redis:7.2-alpine
    container_name: fitpulse-redis-dev
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - fitpulse-network

  # MinIO
  minio:
    image: minio/minio:latest
    container_name: fitpulse-minio-dev
    restart: unless-stopped
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    networks:
      - fitpulse-network

volumes:
  mysql_data:
  redis_data:
  minio_data:

networks:
  fitpulse-network:
    driver: bridge
```

---

### 8.5 Docker Compose - ç”Ÿäº§ç¯å¢ƒ

```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  # åç«¯
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: fitpulse/backend:${VERSION:-latest}
    container_name: fitpulse-backend
    restart: always
    environment:
      SPRING_PROFILES_ACTIVE: prod
      DB_HOST: mysql
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      REDIS_HOST: redis
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      MINIO_ENDPOINT: http://minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY}
      MINIO_SECRET_KEY: ${MINIO_SECRET_KEY}
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
    volumes:
      - backend_logs:/var/log/fitpulse
    networks:
      - fitpulse-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:8080/api/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # å‰ç«¯
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: fitpulse/frontend:${VERSION:-latest}
    container_name: fitpulse-frontend
    restart: always
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - backend
    volumes:
      - ./ssl:/etc/nginx/ssl:ro
    networks:
      - fitpulse-network

  # MySQL
  mysql:
    image: mysql:8.0
    container_name: fitpulse-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: fitpulse_prod
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/conf.d:/etc/mysql/conf.d
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    networks:
      - fitpulse-network

  # Redis
  redis:
    image: redis:7.2-alpine
    container_name: fitpulse-redis
    restart: always
    command: redis-server --requirepass ${REDIS_PASSWORD}
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - fitpulse-network

  # MinIO
  minio:
    image: minio/minio:latest
    container_name: fitpulse-minio
    restart: always
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ACCESS_KEY}
      MINIO_ROOT_PASSWORD: ${MINIO_SECRET_KEY}
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    networks:
      - fitpulse-network

volumes:
  mysql_data:
  redis_data:
  minio_data:
  backend_logs:

networks:
  fitpulse-network:
    driver: bridge
```

---

### 8.6 ç¯å¢ƒå˜é‡æ–‡ä»¶ (.env.prod)

```env
# ç‰ˆæœ¬
VERSION=1.0.0

# æ•°æ®åº“
DB_USERNAME=fitpulse_prod
DB_PASSWORD=Prod@SecurePassword!
MYSQL_ROOT_PASSWORD=Root@SecurePassword!

# Redis
REDIS_PASSWORD=Redis@SecurePassword!

# JWT
JWT_SECRET=your-256-bit-secret-key-change-in-production

# MinIO
MINIO_ACCESS_KEY=fitpulse-minio-key
MINIO_SECRET_KEY=fitpulse-minio-secret-key

# OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_BASE_URL=https://api.openai.com/v1

# é˜¿é‡Œäº‘ OSSï¼ˆå¯é€‰ï¼‰
OSS_ENDPOINT=oss-cn-beijing.aliyuncs.com
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
```

---

## 9. éƒ¨ç½²æ¶æ„

### 9.1 Kubernetes éƒ¨ç½² (ç”Ÿäº§æ¨è)

#### Deployment - åç«¯

```yaml
# k8s/backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fitpulse-backend
  namespace: fitpulse
spec:
  replicas: 3
  selector:
    matchLabels:
      app: fitpulse-backend
  template:
    metadata:
      labels:
        app: fitpulse-backend
    spec:
      containers:
      - name: backend
        image: fitpulse/backend:1.0.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: fitpulse-config
              key: db.host
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: fitpulse-secrets
              key: db.password
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: fitpulse-secrets
              key: openai.api.key
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /api/actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /api/actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: fitpulse-backend-service
  namespace: fitpulse
spec:
  selector:
    app: fitpulse-backend
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 8080
  type: ClusterIP
```

---

### 9.2 è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Load Balancer   â”‚
                        â”‚   (Nginx/ALB)    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend Pod1 â”‚  â”‚ Backend Pod2â”‚  â”‚ Backend Pod3â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. å®‰å…¨é…ç½®

### 10.1 HTTPS/SSL é…ç½®

#### Let's Encrypt è¯ä¹¦ç”³è¯·

```bash
# ä½¿ç”¨ Certbot
certbot certonly --webroot -w /var/www/html \
  -d api.fitpulse.com \
  -d www.fitpulse.com \
  --email admin@fitpulse.com \
  --agree-tos
```

#### Nginx SSL é…ç½®

```nginx
server {
    listen 443 ssl http2;
    server_name api.fitpulse.com;
    
    ssl_certificate /etc/letsencrypt/live/api.fitpulse.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.fitpulse.com/privkey.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # å…¶ä»–å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    location / {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name api.fitpulse.com;
    return 301 https://$server_name$request_uri;
}
```

---

### 10.2 æ•°æ®åº“å®‰å…¨

```sql
-- é™åˆ¶ root ç”¨æˆ·è¿œç¨‹è®¿é—®
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1');

-- åˆ é™¤åŒ¿åç”¨æˆ·
DELETE FROM mysql.user WHERE User='';

-- åˆ é™¤æµ‹è¯•æ•°æ®åº“
DROP DATABASE IF EXISTS test;

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

---

### 10.3 ç¯å¢ƒå˜é‡å®‰å…¨ç®¡ç†

**ç”Ÿäº§ç¯å¢ƒç¦æ­¢æ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯**

#### ä½¿ç”¨ Kubernetes Secrets

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: fitpulse-secrets
  namespace: fitpulse
type: Opaque
stringData:
  db.password: "Prod@SecurePassword!"
  redis.password: "Redis@SecurePassword!"
  jwt.secret: "your-256-bit-secret-key"
  openai.api.key: "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

#### ä½¿ç”¨ HashiCorp Vault (æ¨è)

```bash
# å­˜å‚¨å¯†é’¥
vault kv put secret/fitpulse/prod \
  db.password="Prod@SecurePassword!" \
  openai.api.key="sk-xxxxxxxx"

# åº”ç”¨è¯»å–
vault kv get -field=db.password secret/fitpulse/prod
```

---

## 11. ç›‘æ§ä¸æ—¥å¿—

### 11.1 ç›‘æ§é…ç½®

#### Prometheus + Grafana

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'fitpulse-backend'
    metrics_path: '/api/actuator/prometheus'
    static_configs:
      - targets: ['backend:8080']
```

#### Spring Boot Actuator

```yaml
# application-prod.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
  endpoint:
    health:
      show-details: when-authorized
```

---

### 11.2 æ—¥å¿—æ”¶é›†

#### ELK Stack (Elasticsearch + Logstash + Kibana)

```yaml
# logstash.conf
input {
  file {
    path => "/var/log/fitpulse/backend.log"
    start_position => "beginning"
    codec => json
  }
}

filter {
  if [level] == "ERROR" {
    mutate { add_tag => ["error"] }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "fitpulse-logs-%{+YYYY.MM.dd}"
  }
}
```

#### æ—¥å¿—æ ¼å¼ (JSON)

```yaml
# application-prod.yml
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: /var/log/fitpulse/backend.log
  logback:
    rollingpolicy:
      max-file-size: 100MB
      max-history: 30
      total-size-cap: 3GB
```

---

### 11.3 å‘Šè­¦é…ç½®

#### Prometheus Alertmanager

```yaml
# alertmanager.yml
route:
  receiver: 'fitpulse-alerts'
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h

receivers:
  - name: 'fitpulse-alerts'
    email_configs:
      - to: 'ops@fitpulse.com'
        from: 'alertmanager@fitpulse.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'alertmanager@fitpulse.com'
        auth_password: 'password'
```

---

## 12. ç‰ˆæœ¬å‘å¸ƒæµç¨‹

### 12.1 ç‰ˆæœ¬å·è§„èŒƒ

é‡‡ç”¨ **è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ (Semantic Versioning)**:

```
vä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·

ä¾‹å¦‚: v1.2.3
```

- **ä¸»ç‰ˆæœ¬å·**: é‡å¤§åŠŸèƒ½å˜æ›´ã€ä¸å…¼å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
- **ä¿®è®¢å·**: å‘åå…¼å®¹çš„ Bug ä¿®å¤

---

### 12.2 å‘å¸ƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å‘åˆ†æ”¯     â”‚  develop
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ åŠŸèƒ½å¼€å‘å®Œæˆ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘å¸ƒåˆ†æ”¯     â”‚  release/v1.2.0
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ æµ‹è¯•é€šè¿‡
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»åˆ†æ”¯       â”‚  main (ç”Ÿäº§)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ æ‰“æ ‡ç­¾
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  v1.2.0      â”‚  Git Tag
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 12.3 Docker é•œåƒæ„å»ºä¸å‘å¸ƒ

```bash
#!/bin/bash
# build-and-push.sh

VERSION=$1

if [ -z "$VERSION" ]; then
  echo "ç”¨æ³•: ./build-and-push.sh <version>"
  exit 1
fi

# æ„å»ºåç«¯é•œåƒ
cd backend
docker build -t fitpulse/backend:$VERSION .
docker tag fitpulse/backend:$VERSION fitpulse/backend:latest

# æ„å»ºå‰ç«¯é•œåƒ
cd ../frontend
docker build -t fitpulse/frontend:$VERSION .
docker tag fitpulse/frontend:$VERSION fitpulse/frontend:latest

# æ¨é€åˆ° Docker Hub / ç§æœ‰ä»“åº“
docker push fitpulse/backend:$VERSION
docker push fitpulse/backend:latest
docker push fitpulse/frontend:$VERSION
docker push fitpulse/frontend:latest

echo "âœ… é•œåƒæ„å»ºå¹¶æ¨é€æˆåŠŸ: v$VERSION"
```

---

### 12.4 éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# deploy.sh

ENV=$1  # dev / test / staging / prod
VERSION=$2

if [ -z "$ENV" ] || [ -z "$VERSION" ]; then
  echo "ç”¨æ³•: ./deploy.sh <ç¯å¢ƒ> <ç‰ˆæœ¬>"
  echo "ç¤ºä¾‹: ./deploy.sh prod 1.2.0"
  exit 1
fi

# è®¾ç½®ç¯å¢ƒå˜é‡
export VERSION=$VERSION

# æ‹‰å–æœ€æ–°é•œåƒ
docker-compose -f docker-compose.$ENV.yml pull

# åœæ­¢æ—§å®¹å™¨
docker-compose -f docker-compose.$ENV.yml down

# å¯åŠ¨æ–°å®¹å™¨
docker-compose -f docker-compose.$ENV.yml up -d

# æ£€æŸ¥å¥åº·çŠ¶æ€
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# å¥åº·æ£€æŸ¥
if curl -f http://localhost:8080/api/actuator/health; then
  echo "âœ… éƒ¨ç½²æˆåŠŸ: $ENV ç¯å¢ƒ v$VERSION"
else
  echo "âŒ éƒ¨ç½²å¤±è´¥: å¥åº·æ£€æŸ¥æœªé€šè¿‡"
  exit 1
fi
```

---

### 12.5 å›æ»šç­–ç•¥

```bash
#!/bin/bash
# rollback.sh

ENV=$1
PREVIOUS_VERSION=$2

echo "å¼€å§‹å›æ»šåˆ°ç‰ˆæœ¬: v$PREVIOUS_VERSION"

export VERSION=$PREVIOUS_VERSION

docker-compose -f docker-compose.$ENV.yml pull
docker-compose -f docker-compose.$ENV.yml up -d

echo "âœ… å›æ»šå®Œæˆ"
```

---

## 13. é™„å½•

### 13.1 ç¯å¢ƒå˜é‡æ¸…å•

| å˜é‡å | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `SPRING_PROFILES_ACTIVE` | âœ… | Spring ç¯å¢ƒ | dev / test / prod |
| `DB_HOST` | âœ… | æ•°æ®åº“ä¸»æœº | mysql-prod |
| `DB_USERNAME` | âœ… | æ•°æ®åº“ç”¨æˆ· | fitpulse_prod |
| `DB_PASSWORD` | âœ… | æ•°æ®åº“å¯†ç  | SecurePassword! |
| `REDIS_HOST` | âœ… | Redis ä¸»æœº | redis-prod |
| `REDIS_PASSWORD` | âœ… | Redis å¯†ç  | RedisPassword! |
| `JWT_SECRET` | âœ… | JWT å¯†é’¥ | 256-bit-key |
| `OPENAI_API_KEY` | âœ… | OpenAI API Key | sk-xxxxxxxx |
| `MINIO_ENDPOINT` | âœ… | MinIO ç«¯ç‚¹ | http://minio:9000 |
| `MINIO_ACCESS_KEY` | âœ… | MinIO è®¿é—®å¯†é’¥ | minioadmin |
| `MINIO_SECRET_KEY` | âœ… | MinIO å¯†é’¥ | minioadmin |

---

### 13.2 ç«¯å£æ¸…å•

| æœåŠ¡ | ç«¯å£ | åè®® | è¯´æ˜ |
|------|------|------|------|
| å‰ç«¯ | 80 | HTTP | Web ç•Œé¢ |
| å‰ç«¯ | 443 | HTTPS | åŠ å¯†è®¿é—® |
| åç«¯ | 8080 | HTTP | API æœåŠ¡ |
| MySQL | 3306 | TCP | æ•°æ®åº“ |
| Redis | 6379 | TCP | ç¼“å­˜ |
| MinIO | 9000 | HTTP | å¯¹è±¡å­˜å‚¨ API |
| MinIO Console | 9001 | HTTP | ç®¡ç†ç•Œé¢ |
| Prometheus | 9090 | HTTP | ç›‘æ§ |
| Grafana | 3000 | HTTP | å¯è§†åŒ– |

---

### 13.3 æ€§èƒ½å»ºè®®

#### åç«¯ JVM å‚æ•°

```bash
# ç”Ÿäº§ç¯å¢ƒæ¨è
JAVA_OPTS="-Xms2g -Xmx2g \
  -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 \
  -XX:+HeapDumpOnOutOfMemoryError \
  -XX:HeapDumpPath=/var/log/fitpulse/heapdump.hprof \
  -Djava.security.egd=file:/dev/./urandom"
```

#### MySQL ä¼˜åŒ–

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY query_time DESC LIMIT 10;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SHOW INDEX FROM diet_log;

-- åˆ†æè¡¨
ANALYZE TABLE diet_log;
```

---

### 13.4 å¸¸è§é—®é¢˜æ’æŸ¥

#### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
docker ps | grep mysql

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs fitpulse-mysql

# æµ‹è¯•è¿æ¥
mysql -h localhost -u fitpulse -p -D fitpulse_dev
```

#### Redis è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ Redis çŠ¶æ€
docker exec -it fitpulse-redis redis-cli ping

# ä½¿ç”¨å¯†ç è¿æ¥
docker exec -it fitpulse-redis redis-cli -a ${REDIS_PASSWORD}
```

#### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs fitpulse-backend

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker inspect fitpulse-backend

# è¿›å…¥å®¹å™¨æ’æŸ¥
docker exec -it fitpulse-backend sh
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| V1.0.0 | 2025-12-04 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´ç¯å¢ƒé…ç½®æ–‡æ¡£ |

---

## è”ç³»æ–¹å¼

- **é¡¹ç›®åç§°**: FitPulse (è„‰åŠ¨å¥åº·)
- **æŠ€æœ¯æ ˆ**: Spring Boot + Vue 3 + MySQL + Redis
- **æ–‡æ¡£ç»´æŠ¤**: DevOps å›¢é˜Ÿ

---

**ğŸ“Œ æç¤º**: æœ¬æ–‡æ¡£ä¸º Docker å®¹å™¨åŒ–éƒ¨ç½²å’Œç‰ˆæœ¬ä¸Šçº¿æä¾›å®Œæ•´çš„ç¯å¢ƒé…ç½®æŒ‡å—ï¼Œå»ºè®®ä¸ API è®¾è®¡æ–‡æ¡£ã€æ•°æ®åº“è®¾è®¡æ–‡æ¡£é…åˆä½¿ç”¨ã€‚
